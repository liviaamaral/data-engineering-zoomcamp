id: 03_postgres_taxi_2021
namespace: zoomcamp
description: |
  Backfill 2021 data (Janâ€“Jul) for both yellow and green taxi types using the Postgres flow (no GCP required).

tasks:
  - id: foreach_taxi
    type: io.kestra.plugin.core.flow.ForEach
    values: ["yellow", "green"]
    tasks:
    - id: foreach_month
      type: io.kestra.plugin.core.flow.ForEach
      values: ["01", "02", "03", "04", "05", "06", "07"]
      tasks:
        - id: run_subflow
          type: io.kestra.plugin.core.flow.Subflow
          namespace: zoomcamp
          flowId: 02_postgres_taxi
          inputs:
            taxi: "{{parents[0].taskrun.value}}"   # taxi from outer loop
            year: "2021"
            month: "{{taskrun.value}}"        # month from inner loop